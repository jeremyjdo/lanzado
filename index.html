<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Lanzado</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 70px;
        }

        header {
            text-align: center;
            padding: 1.5rem 1rem 1rem;
            position: sticky;
            top: 0;
            background: #0a0a0a;
            z-index: 100;
        }

        h1 {
            font-size: 1.6rem;
            font-weight: 600;
            letter-spacing: 0.2em;
        }

        .tabs {
            display: flex;
            gap: 0;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0a0a0a;
            border-top: 1px solid #222;
            padding: 0.5rem 0;
            padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
            z-index: 1000;
        }

        .tab {
            flex: 1;
            padding: 0.5rem 0.3rem 0.4rem;
            background: none;
            border: none;
            color: #555;
            font-family: inherit;
            font-size: 0.6rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .tab svg {
            width: 22px;
            height: 22px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        .tab.active {
            color: #fff;
        }

        .tab-content {
            display: none;
            padding: 1rem;
        }

        .tab-content.active {
            display: block;
        }

        #map-tab {
            padding: 0;
        }

        #map-tab.active {
            display: block;
        }

        /* Leaflet map */
        #leaflet-map {
            width: 100%;
            height: calc(100vh - 120px);
            background: #0a0a0a;
        }

        .leaflet-container {
            background: #0a0a0a;
        }

        .leaflet-tile-pane {
            filter: grayscale(100%) invert(100%) contrast(90%) brightness(80%);
        }

        .leaflet-control-zoom {
            border: none !important;
        }

        .leaflet-control-zoom a {
            background: #1a1a1a !important;
            color: #fff !important;
            border: 1px solid #333 !important;
        }

        .leaflet-control-attribution {
            background: rgba(10,10,10,0.8) !important;
            color: #555 !important;
            font-size: 8px !important;
        }

        .leaflet-control-attribution a {
            color: #666 !important;
        }

        /* Custom map markers */
        .custom-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid #fff;
            background: #0a0a0a;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }

        .custom-marker svg {
            width: 20px;
            height: 20px;
            stroke: #fff;
            stroke-width: 2;
            fill: none;
        }

        .custom-marker:hover {
            transform: scale(1.15);
        }

        .custom-marker.checked {
            background: #222;
            border-color: #444;
            opacity: 0.5;
        }

        .custom-marker.checked svg {
            stroke: #666;
        }

        /* Popup styles - responsive like todo cards */
        .leaflet-popup-content-wrapper {
            background: #111;
            color: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
            padding: 0;
            overflow: hidden;
        }

        .leaflet-popup-tip {
            background: #111;
        }

        .leaflet-popup-content {
            margin: 0;
            width: calc(100vw - 3rem) !important;
            max-width: 360px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .leaflet-popup-close-button {
            color: #555 !important;
            font-size: 24px !important;
            padding: 12px 14px !important;
            width: auto !important;
            height: auto !important;
        }

        .popup-card {
            padding: 1.25rem;
        }

        .popup-header {
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
            margin-bottom: 0.75rem;
        }

        .popup-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .popup-icon svg {
            width: 22px;
            height: 22px;
            stroke: #fff;
            stroke-width: 2;
            fill: none;
        }

        .popup-title {
            flex: 1;
            min-width: 0;
        }

        .popup-name {
            font-weight: 500;
            font-size: 1rem;
            margin-bottom: 0.2rem;
            line-height: 1.3;
        }

        .popup-category {
            font-size: 0.65rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .popup-desc {
            color: #666;
            font-size: 0.8rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .popup-actions {
            display: flex;
            gap: 0.6rem;
        }

        .popup-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 0.875rem;
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .popup-btn svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .popup-btn-maps {
            background: #fff;
            color: #000;
            border: none;
        }

        .popup-btn-maps svg {
            stroke: #000;
            fill: none;
        }

        .popup-btn-maps:hover {
            background: #eee;
        }

        .popup-btn-maps:active {
            transform: scale(0.98);
        }

        .popup-btn-check {
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
        }

        .popup-btn-check svg {
            stroke: #fff;
            fill: none;
        }

        .popup-btn-check:hover {
            background: #222;
            border-color: #444;
        }

        .popup-btn-check:active {
            transform: scale(0.98);
        }

        .popup-btn-check.checked {
            background: #1a3a1a;
            border-color: #2a5a2a;
            color: #6f6;
        }

        .popup-btn-check.checked svg {
            stroke: #6f6;
        }

        .map-legend {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 1.2rem;
            background: rgba(10,10,10,0.95);
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            font-size: 0.7rem;
            color: #888;
            z-index: 500;
            border: 1px solid #222;
        }

        .map-legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .map-legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid #fff;
            background: #0a0a0a;
        }

        .map-legend-dot.done {
            background: #333;
            border-color: #444;
            opacity: 0.5;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            color: #555;
            text-transform: uppercase;
            margin-bottom: 1rem;
            padding-left: 0.5rem;
        }

        /* Todo items */
        .item {
            background: #111;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .item:hover {
            background: #151515;
            border-color: #222;
            transform: translateY(-1px);
        }

        .item:active {
            transform: scale(0.99);
        }

        .item.checked {
            opacity: 0.4;
        }

        .item.checked:hover {
            opacity: 0.5;
        }

        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 0.875rem;
        }

        .item-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        .item-icon svg {
            width: 22px;
            height: 22px;
            stroke: #fff;
            stroke-width: 2;
            fill: none;
        }

        .item:hover .item-icon {
            background: #222;
            transform: scale(1.05);
        }

        .checkbox {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid #333;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            margin-top: 10px;
            position: relative;
        }

        .checkbox:hover {
            border-color: #555;
        }

        .checkbox:checked {
            background: #fff;
            border-color: #fff;
        }

        .checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-size: 14px;
            font-weight: bold;
        }

        .item-content {
            flex: 1;
            min-width: 0;
        }

        .item-name {
            font-weight: 500;
            font-size: 1rem;
            margin-bottom: 0.35rem;
            transition: all 0.2s;
        }

        .item.checked .item-name {
            text-decoration: line-through;
        }

        .item-desc {
            font-size: 0.8rem;
            color: #666;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .gps-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.6rem 1rem;
            background: #1a1a1a;
            border-radius: 8px;
            color: #888;
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.2s;
            border: 1px solid #222;
        }

        .gps-btn:hover {
            background: #222;
            color: #fff;
            border-color: #333;
        }

        .gps-btn svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        /* Food items */
        .food-item {
            background: #111;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .food-item:hover {
            background: #151515;
            border-color: #222;
        }

        .food-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .food-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .food-icon svg {
            width: 18px;
            height: 18px;
            stroke: #fff;
            stroke-width: 2;
            fill: none;
        }

        .food-name {
            font-weight: 500;
            font-size: 1rem;
        }

        .food-desc {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.5;
            padding-left: 2.875rem;
        }

        .food-tip {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.6rem;
            padding-left: 2.875rem;
            padding-top: 0.5rem;
            border-top: 1px solid #1a1a1a;
        }

        .phrase {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #1a1a1a;
            gap: 1rem;
            transition: all 0.2s;
        }

        .phrase:hover {
            background: #151515;
            margin: 0 -0.5rem;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            border-radius: 8px;
        }

        .phrase:last-child {
            border-bottom: none;
        }

        .phrase-es {
            font-weight: 500;
            color: #fff;
            flex-shrink: 0;
        }

        .phrase-fr {
            color: #666;
            font-size: 0.85rem;
            text-align: right;
        }

        .trad-section {
            background: #111;
            border-radius: 16px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .trad-section:hover {
            border-color: #222;
        }

        .trad-title {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>LANZADO</h1>
        </header>

        <div id="map-tab" class="tab-content active">
            <div id="leaflet-map"></div>
            <div class="map-legend">
                <div class="map-legend-item"><div class="map-legend-dot"></div> À faire</div>
                <div class="map-legend-item"><div class="map-legend-dot done"></div> Fait</div>
            </div>
        </div>
        <div id="todo" class="tab-content"></div>
        <div id="food" class="tab-content"></div>
        <div id="trad" class="tab-content"></div>
    </div>

    <div class="tabs">
        <button class="tab active" data-tab="map-tab">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z"/><path d="M15 5.764v15"/><path d="M9 3.236v15"/></svg>
            Carte
        </button>
        <button class="tab" data-tab="todo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m9 11 3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
            To Do
        </button>
        <button class="tab" data-tab="food">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>
            À déguster
        </button>
        <button class="tab" data-tab="trad">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m5 8 6 6"/><path d="m4 14 6-6 2-3"/><path d="M2 5h12"/><path d="M7 2h1"/><path d="m22 22-5-10-5 10"/><path d="M14 18h6"/></svg>
            Trad
        </button>
    </div>

    <script>
        // ============ LUCIDE ICONS (SVG) ============
        const icons = {
            // Incontournables
            flame: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>',
            waves: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></svg>',
            flower: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 16.5A4.5 4.5 0 1 1 7.5 12 4.5 4.5 0 1 1 12 7.5a4.5 4.5 0 1 1 4.5 4.5 4.5 4.5 0 1 1-4.5 4.5"/><path d="M12 7.5V9"/><path d="M7.5 12H9"/><path d="M16.5 12H15"/><path d="M12 16.5V15"/></svg>',
            mountain: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></svg>',
            eye: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>',
            sparkles: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"/></svg>',
            // En famille
            pawPrint: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="11" cy="4" r="2"/><circle cx="18" cy="8" r="2"/><circle cx="20" cy="16" r="2"/><path d="M9 10a5 5 0 0 1 5 5v3.5a3.5 3.5 0 0 1-6.84 1.045Q6.52 17.48 4.46 16.84A3.5 3.5 0 0 1 5.5 10Z"/></svg>',
            ship: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 10.189V14"/><path d="M12 2v3"/><path d="M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6"/><path d="M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 1.62 6"/><path d="M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></svg>',
            fish: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z"/><path d="M18 12v.5"/><path d="M16 17.93a9.77 9.77 0 0 1-3.5.07"/><path d="M2 12h4"/><path d="M10.5 4.75c-1.21.95-2.19 2.48-2.88 4.14"/><path d="M10.5 19.25c-1.21-.95-2.19-2.48-2.88-4.14"/></svg>',
            ferrisWheel: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="2"/><path d="M12 2v4"/><path d="m6.8 15-3.5 2"/><path d="m20.7 7-3.5 2"/><path d="M6.8 9 3.3 7"/><path d="m20.7 17-3.5-2"/><path d="m9 22 3-8 3 8"/><path d="M8 22h8"/><path d="M18 18.7a9 9 0 1 0-12 0"/></svg>',
            // Plages
            umbrella: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2v1"/><path d="M15.5 21a1.5 1.5 0 0 1-3 0V12"/><path d="M18.314 9.314A8.001 8.001 0 0 0 4 12h16a1 1 0 0 0 .914-1.406A5.503 5.503 0 0 0 18.314 9.314Z"/></svg>',
            shell: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 11a2 2 0 1 1-4 0 4 4 0 0 1 8 0 6 6 0 0 1-12 0 8 8 0 0 1 16 0 10 10 0 1 1-20 0 11.93 11.93 0 0 1 2.42-7.22 2 2 0 1 1 3.16 2.44"/></svg>',
            sunset: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 10V2"/><path d="m4.93 10.93 1.41 1.41"/><path d="M2 18h2"/><path d="M20 18h2"/><path d="m19.07 10.93-1.41 1.41"/><path d="M22 22H2"/><path d="m16 6-4 4-4-4"/><path d="M16 18a4 4 0 0 0-8 0"/></svg>',
            // Spots photo
            camera: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>',
            grape: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 5V2l-5.89 5.89"/><circle cx="16.6" cy="15.89" r="3"/><circle cx="8.11" cy="7.4" r="3"/><circle cx="12.35" cy="11.65" r="3"/><circle cx="13.91" cy="5.85" r="3"/><circle cx="18.15" cy="10.09" r="3"/><circle cx="6.56" cy="13.2" r="3"/><circle cx="10.8" cy="17.44" r="3"/><circle cx="5" cy="19" r="3"/></svg>',
            landmark: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><line x1="3" x2="21" y1="22" y2="22"/><line x1="6" x2="6" y1="18" y2="11"/><line x1="10" x2="10" y1="18" y2="11"/><line x1="14" x2="14" y1="18" y2="11"/><line x1="18" x2="18" y1="18" y2="11"/><polygon points="12 2 20 7 4 7"/></svg>',
            heart: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>',
            // Other
            mapPin: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/><circle cx="12" cy="10" r="3"/></svg>',
            check: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>',
            utensils: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>',
            coffee: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2v2"/><path d="M14 2v2"/><path d="M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1"/><path d="M6 2v2"/></svg>',
            beer: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 11h1a3 3 0 0 1 0 6h-1"/><path d="M9 12v6"/><path d="M13 12v6"/><path d="M14 7.5c-1 0-1.44.5-3 .5s-2-.5-3-.5-1.72.5-2.5.5a2.5 2.5 0 0 1 0-5c.78 0 1.57.5 2.5.5S9.44 2 11 2s2 1.5 3 1.5 1.72-.5 2.5-.5a2.5 2.5 0 0 1 0 5c-.78 0-1.5-.5-2.5-.5Z"/><path d="M5 8v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V8"/></svg>',
            lightbulb: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>'
        };

        // Map icon names to items
        const itemIcons = {
            "Parc National de Timanfaya": "flame",
            "Jameos del Agua": "waves",
            "Jardin de Cactus": "flower",
            "Mirador del Río": "eye",
            "Cueva de los Verdes": "sparkles",
            "Rancho Texas Lanzarote Park": "pawPrint",
            "Excursion La Graciosa": "ship",
            "Safari sous-marin / Dauphins": "fish",
            "Aquapark Costa Teguise": "ferrisWheel",
            "Playa Flamingo": "umbrella",
            "Playa de Papagayo": "shell",
            "Playa Janubio & Salinas": "sunset",
            "Montaña de los Cuervos": "mountain",
            "Los Hervideros": "waves",
            "Charco de los Clicos (Lago Verde)": "heart",
            "La Geria (vignobles)": "grape",
            "El Bosquecillo (Famara)": "camera"
        };

        const foodItemIcons = {
            "Papas arrugadas + mojo": "utensils",
            "Pescado a la plancha": "fish",
            "Pulpo a la gallega / frito": "utensils",
            "Ropa vieja canaria": "utensils",
            "Sancocho canario": "utensils",
            "Gofio": "utensils",
            "Calamares fritos": "utensils",
            "Gambas al ajillo": "utensils",
            "Chocos": "utensils",
            "Vin de La Geria": "grape",
            "Cerveza Dorada / Tropical": "beer",
            "Jus de fruits frais": "coffee",
            "Phrases utiles": "lightbulb"
        };

        // ============ DATA ============

        const todoData = {
            "Incontournables": [
                { name: "Parc National de Timanfaya", desc: "Montagnes de Feu — paysage lunaire, cratères, démonstrations géothermiques. Balade à dos de chameau possible.", gps: "https://www.google.com/maps/search/?api=1&query=Timanfaya+National+Park+Lanzarote", coords: [29.01, -13.75] },
                { name: "Jameos del Agua", desc: "Tunnels de lave par César Manrique — lac souterrain, jardin luxuriant, piscine.", gps: "https://www.google.com/maps/search/?api=1&query=Jameos+del+Agua+Lanzarote", coords: [29.16, -13.43] },
                { name: "Jardin de Cactus", desc: "Jardin botanique avec des milliers de cactus de toutes formes — très photogénique.", gps: "https://www.google.com/maps/search/?api=1&query=Jardin+de+Cactus+Lanzarote", coords: [29.08, -13.45] },
                { name: "Mirador del Río", desc: "Point de vue spectaculaire sur La Graciosa, par César Manrique.", gps: "https://www.google.com/maps/search/?api=1&query=Mirador+del+Rio+Lanzarote", coords: [29.21, -13.48] },
                { name: "Cueva de los Verdes", desc: "Tunnel de lave souterrain impressionnant.", gps: "https://www.google.com/maps/search/?api=1&query=Cueva+de+los+Verdes+Lanzarote", coords: [29.16, -13.44] }
            ],
            "En famille": [
                { name: "Rancho Texas Lanzarote Park", desc: "Parc animalier + aquatique — spectacles d'animaux, piscines, toboggans. Idéal journée complète.", gps: "https://www.google.com/maps/search/?api=1&query=Rancho+Texas+Lanzarote+Park", coords: [28.93, -13.62] },
                { name: "Excursion La Graciosa", desc: "Ferry depuis Orzola — île tranquille avec belles plages, vélo, balades.", gps: "https://www.google.com/maps/search/?api=1&query=Orzola+Ferry+La+Graciosa+Lanzarote", coords: [29.22, -13.45] },
                { name: "Safari sous-marin / Dauphins", desc: "Excursions pour voir la vie marine depuis un sous-marin ou bateau.", gps: "https://www.google.com/maps/search/?api=1&query=Puerto+del+Carmen+Lanzarote", coords: [28.92, -13.68] },
                { name: "Aquapark Costa Teguise", desc: "Toboggans et piscines pour toute la famille.", gps: "https://www.google.com/maps/search/?api=1&query=Aquapark+Costa+Teguise+Lanzarote", coords: [28.99, -13.50] }
            ],
            "Plages": [
                { name: "Playa Flamingo", desc: "Eaux calmes, idéale pour les enfants.", gps: "https://www.google.com/maps/search/?api=1&query=Playa+Flamingo+Lanzarote", coords: [28.86, -13.83] },
                { name: "Playa de Papagayo", desc: "Plus belle plage de l'île — sable doré, eaux turquoises.", gps: "https://www.google.com/maps/search/?api=1&query=Playa+Papagayo+Lanzarote", coords: [28.84, -13.78] },
                { name: "Playa Janubio & Salinas", desc: "Plage de sable noir + salines colorées au coucher du soleil.", gps: "https://www.google.com/maps/search/?api=1&query=Salinas+de+Janubio+Lanzarote", coords: [28.94, -13.82] }
            ],
            "Spots photo": [
                { name: "Montaña de los Cuervos", desc: "Caldeira volcanique accessible à pied — très photogénique au lever/coucher du soleil.", gps: "https://www.google.com/maps/search/?api=1&query=Montana+de+los+Cuervos+Lanzarote", coords: [29.00, -13.72] },
                { name: "Los Hervideros", desc: "Falaises volcaniques sculptées par l'océan — arches, grottes, vagues.", gps: "https://www.google.com/maps/search/?api=1&query=Los+Hervideros+Lanzarote", coords: [28.95, -13.81] },
                { name: "Charco de los Clicos (Lago Verde)", desc: "Lac vert émeraude dans un cratère, bordé de sable noir.", gps: "https://www.google.com/maps/search/?api=1&query=Charco+de+los+Clicos+El+Golfo+Lanzarote", coords: [28.97, -13.83] },
                { name: "La Geria (vignobles)", desc: "Vignes dans les cendres volcaniques — contraste noir/vert unique.", gps: "https://www.google.com/maps/search/?api=1&query=La+Geria+Lanzarote", coords: [29.03, -13.70] },
                { name: "El Bosquecillo (Famara)", desc: "Belvédère surplombant la côte de Famara — falaises et océan.", gps: "https://www.google.com/maps/search/?api=1&query=El+Bosquecillo+Famara+Lanzarote", coords: [29.11, -13.60] }
            ]
        };

        const foodData = {
            "Plats traditionnels": [
                { name: "Papas arrugadas + mojo", desc: "Petites pommes de terre cuites dans l'eau très salée. Servies avec mojo rojo (rouge, poivron) ou mojo verde (vert, coriandre).", tip: "Très apprécié des enfants, surtout avec le mojo verde." },
                { name: "Pescado a la plancha", desc: "Poisson du jour grillé — dorade, vieja, thon. Simple et délicieux." },
                { name: "Pulpo a la gallega / frito", desc: "Poulpe tendre au paprika et huile d'olive, ou frit croustillant.", tip: "Passe bien avec les enfants curieux." },
                { name: "Ropa vieja canaria", desc: "Ragoût de viande effilochée, pois chiches, légumes, épices douces.", tip: "Pas épicé, réconfortant comme à la maison." },
                { name: "Sancocho canario", desc: "Plat typique du week-end — poisson salé (cherne) avec pommes de terre et gofio." },
                { name: "Gofio", desc: "Farine de céréales grillées ancestrale — en accompagnement, soupe ou dessert.", tip: "À goûter au moins une fois pour l'expérience." }
            ],
            "Tapas & fruits de mer": [
                { name: "Calamares fritos", desc: "Calamars frits — classique et efficace." },
                { name: "Gambas al ajillo", desc: "Crevettes à l'ail — parfait à partager." },
                { name: "Chocos", desc: "Petites seiches frites ou grillées." }
            ],
            "Boissons": [
                { name: "Vin de La Geria", desc: "Vignes volcaniques — blanc très original et minéral." },
                { name: "Cerveza Dorada / Tropical", desc: "Bières locales canariennes." },
                { name: "Jus de fruits frais", desc: "Excellents pour les enfants." }
            ],
            "Astuces": [
                { name: "Phrases utiles", desc: "Plato para compartir → portions à partager\nPlato del día → plat du jour\n¿Es picante? → C'est épicé ? (souvent non)" }
            ]
        };

        const tradData = {
            "Salutations": [
                { es: "Hola", fr: "Bonjour / Salut" },
                { es: "Buenos días", fr: "Bonjour (matin)" },
                { es: "Buenas tardes", fr: "Bon après-midi" },
                { es: "Buenas noches", fr: "Bonsoir / Bonne nuit" },
                { es: "Adiós", fr: "Au revoir" },
                { es: "Hasta luego", fr: "À plus tard" }
            ],
            "Basiques": [
                { es: "Por favor", fr: "S'il vous plaît" },
                { es: "Gracias", fr: "Merci" },
                { es: "Muchas gracias", fr: "Merci beaucoup" },
                { es: "De nada", fr: "De rien" },
                { es: "Perdón / Disculpe", fr: "Pardon / Excusez-moi" }
            ],
            "Se présenter": [
                { es: "Nosotros somos franceses", fr: "Nous sommes français" },
                { es: "Estamos de vacaciones", fr: "Nous sommes en vacances" },
                { es: "Viajamos con nuestra hija", fr: "Nous voyageons avec notre fille" },
                { es: "¿Habla francés o inglés?", fr: "Parlez-vous français ou anglais ?" }
            ],
            "Se déplacer": [
                { es: "¿Dónde está…?", fr: "Où se trouve… ?" },
                { es: "¿Cómo se llega a…?", fr: "Comment aller à… ?" },
                { es: "¿Está lejos?", fr: "C'est loin ?" },
                { es: "A la derecha", fr: "À droite" },
                { es: "A la izquierda", fr: "À gauche" },
                { es: "Todo recto", fr: "Tout droit" }
            ],
            "Au restaurant": [
                { es: "Una mesa para tres, por favor", fr: "Une table pour trois" },
                { es: "¿Podemos ver la carta?", fr: "La carte, s'il vous plaît" },
                { es: "¿Qué nos recomienda?", fr: "Que nous recommandez-vous ?" },
                { es: "Para mi hija…", fr: "Pour ma fille…" },
                { es: "No es picante", fr: "Ce n'est pas épicé" },
                { es: "Está muy rico", fr: "C'est très bon" },
                { es: "La cuenta, por favor", fr: "L'addition, s'il vous plaît" }
            ],
            "Urgences": [
                { es: "Necesito ayuda", fr: "J'ai besoin d'aide" },
                { es: "¿Hay un médico?", fr: "Y a-t-il un médecin ?" },
                { es: "Mi hija no se siente bien", fr: "Ma fille ne se sent pas bien" },
                { es: "Una farmacia", fr: "Une pharmacie" }
            ],
            "Phrases sympas": [
                { es: "Es muy bonito", fr: "C'est très beau" },
                { es: "Nos encanta Lanzarote", fr: "On adore Lanzarote" }
            ]
        };

        // ============ MAP ============

        let map;
        let markers = [];

        function getIcon(name) {
            const iconName = itemIcons[name] || 'mapPin';
            return icons[iconName] || icons.mapPin;
        }

        function initMap() {
            map = L.map('leaflet-map', {
                zoomControl: true,
                attributionControl: true
            }).setView([29.0, -13.65], 10);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '© OpenStreetMap © CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            let idx = 0;
            for (const [section, items] of Object.entries(todoData)) {
                for (const item of items) {
                    if (item.coords) {
                        const id = `t${idx++}`;
                        const isChecked = localStorage.getItem(id) === 'true';
                        const iconSvg = getIcon(item.name);

                        const markerIcon = L.divIcon({
                            className: 'custom-marker' + (isChecked ? ' checked' : ''),
                            html: iconSvg,
                            iconSize: [40, 40],
                            iconAnchor: [20, 20]
                        });

                        const marker = L.marker(item.coords, { icon: markerIcon }).addTo(map);

                        const popupContent = `
                            <div class="popup-card">
                                <div class="popup-header">
                                    <div class="popup-icon">${iconSvg}</div>
                                    <div class="popup-title">
                                        <div class="popup-name">${item.name}</div>
                                        <div class="popup-category">${section}</div>
                                    </div>
                                </div>
                                <div class="popup-desc">${item.desc}</div>
                                <div class="popup-actions">
                                    <a href="${item.gps}" target="_blank" class="popup-btn popup-btn-maps">
                                        ${icons.mapPin}
                                        Ouvrir Maps
                                    </a>
                                    <button class="popup-btn popup-btn-check ${isChecked ? 'checked' : ''}" data-id="${id}">
                                        ${icons.check}
                                        ${isChecked ? 'Fait' : 'À faire'}
                                    </button>
                                </div>
                            </div>`;

                        marker.bindPopup(popupContent, { maxWidth: 400 });

                        markers.push({ marker, id, item });
                    }
                }
            }

            map.on('popupopen', (e) => {
                const checkBtn = e.popup._contentNode.querySelector('.popup-btn-check');
                if (checkBtn) {
                    checkBtn.addEventListener('click', () => {
                        const id = checkBtn.dataset.id;
                        const isCurrentlyChecked = localStorage.getItem(id) === 'true';
                        const newState = !isCurrentlyChecked;

                        localStorage.setItem(id, newState);
                        checkBtn.classList.toggle('checked', newState);
                        checkBtn.innerHTML = `${icons.check} ${newState ? 'Fait' : 'À faire'}`;

                        updateMapMarkers();
                        updateTodoCheckboxes();
                    });
                }
            });
        }

        function updateMapMarkers() {
            markers.forEach(({ marker, id, item }) => {
                const isChecked = localStorage.getItem(id) === 'true';
                const iconSvg = getIcon(item.name);
                const newIcon = L.divIcon({
                    className: 'custom-marker' + (isChecked ? ' checked' : ''),
                    html: iconSvg,
                    iconSize: [40, 40],
                    iconAnchor: [20, 20]
                });
                marker.setIcon(newIcon);
            });
        }

        function updateTodoCheckboxes() {
            document.querySelectorAll('.checkbox').forEach(cb => {
                const isChecked = localStorage.getItem(cb.id) === 'true';
                cb.checked = isChecked;
                cb.closest('.item')?.classList.toggle('checked', isChecked);
            });
        }

        // ============ RENDER ============

        function renderTodo() {
            const container = document.getElementById('todo');
            let html = '';
            let idx = 0;

            for (const [section, items] of Object.entries(todoData)) {
                html += `<div class="section"><h2 class="section-title">${section}</h2>`;
                for (const item of items) {
                    const id = `t${idx++}`;
                    const iconSvg = getIcon(item.name);
                    html += `
                        <div class="item">
                            <div class="item-header">
                                <div class="item-icon">${iconSvg}</div>
                                <div class="item-content">
                                    <div class="item-name">${item.name}</div>
                                    <div class="item-desc">${item.desc}</div>
                                    ${item.gps ? `<a href="${item.gps}" target="_blank" class="gps-btn">${icons.mapPin} Ouvrir Maps</a>` : ''}
                                </div>
                                <input type="checkbox" class="checkbox" id="${id}">
                            </div>
                        </div>`;
                }
                html += '</div>';
            }
            container.innerHTML = html;
        }

        function renderFood() {
            const container = document.getElementById('food');
            let html = '';

            for (const [section, items] of Object.entries(foodData)) {
                html += `<div class="section"><h2 class="section-title">${section}</h2>`;
                for (const item of items) {
                    const iconName = foodItemIcons[item.name] || 'utensils';
                    const iconSvg = icons[iconName] || icons.utensils;
                    html += `
                        <div class="food-item">
                            <div class="food-header">
                                <div class="food-icon">${iconSvg}</div>
                                <div class="food-name">${item.name}</div>
                            </div>
                            <div class="food-desc">${item.desc.replace(/\n/g, '<br>')}</div>
                            ${item.tip ? `<div class="food-tip">${item.tip}</div>` : ''}
                        </div>`;
                }
                html += '</div>';
            }
            container.innerHTML = html;
        }

        function renderTrad() {
            const container = document.getElementById('trad');
            let html = '';

            for (const [section, phrases] of Object.entries(tradData)) {
                html += `<div class="trad-section"><div class="trad-title">${section}</div>`;
                for (const p of phrases) {
                    html += `<div class="phrase"><span class="phrase-es">${p.es}</span><span class="phrase-fr">${p.fr}</span></div>`;
                }
                html += '</div>';
            }
            container.innerHTML = html;
        }

        // ============ INIT ============

        initMap();
        renderTodo();
        renderFood();
        renderTrad();

        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');

                if (tab.dataset.tab === 'map-tab') {
                    setTimeout(() => map.invalidateSize(), 100);
                }
            });
        });

        // Checkboxes persistence
        document.addEventListener('change', e => {
            if (e.target.classList.contains('checkbox')) {
                localStorage.setItem(e.target.id, e.target.checked);
                e.target.closest('.item')?.classList.toggle('checked', e.target.checked);
                updateMapMarkers();
            }
        });

        // Restore checkboxes
        document.querySelectorAll('.checkbox').forEach(cb => {
            if (localStorage.getItem(cb.id) === 'true') {
                cb.checked = true;
                cb.closest('.item')?.classList.add('checked');
            }
        });
    </script>
</body>
</html>
